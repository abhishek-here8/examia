<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>EXAMIA – Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<h1>EXAMIA – Admin</h1>

<section>
  <a href="index.html">Home</a> |
  <a href="pyqs.html">PYQs</a> |
  <a href="admin.html">Admin</a>
</section>

<section id="loginBox">
  <h2>Admin Login</h2>

  <label><b>Admin ID</b></label><br/>
  <input id="loginId" type="text" placeholder="Enter Admin ID" />
  <br/><br/>

  <label><b>Password</b></label><br/>
  <input id="loginPass" type="password" placeholder="Enter Password" />
  <br/><br/>

  <button id="loginBtn">Login</button>
  <p id="loginStatus"></p>
</section>

<section id="adminBox" style="display:none;">
  <h2>Add a New PYQ</h2>

  <button id="logoutBtn">Logout</button>
  <br/><br/>

  <label><b>Exam</b></label><br />
  <select id="exam">
    <option value="JEE Main">JEE Main</option>
    <option value="JEE Advanced">JEE Advanced</option>
  </select>
  <br /><br />

  <label><b>Year</b></label><br />
  <input id="year" type="text" value="2023" />
  <br /><br />

  <label><b>Subject</b></label><br />
  <select id="subject">
    <option value="Physics">Physics</option>
    <option value="Chemistry">Chemistry</option>
    <option value="Maths">Maths</option>
  </select>
  <br /><br />

  <label><b>Question</b></label><br />
  <textarea id="question" rows="4" style="width: 100%;"></textarea>
  <br /><br />

  <label><b>Solution</b></label><br />
  <textarea id="solution" rows="4" style="width: 100%;"></textarea>
  <br /><br />

  <button id="submitBtn">Add PYQ</button>
  <p id="status" style="margin-top: 10px;"></p>
</section>

<script>
  const API_BASE = "https://examia-tkwz.onrender.com";

  function getToken() {
    return sessionStorage.getItem("admin_token");
  }

  function setToken(t) {
    sessionStorage.setItem("admin_token", t);
  }

  function clearToken() {
    sessionStorage.removeItem("admin_token");
  }

  function showAdminUI() {
    document.getElementById("loginBox").style.display = "none";
    document.getElementById("adminBox").style.display = "block";
  }

  function showLoginUI() {
    document.getElementById("loginBox").style.display = "block";
    document.getElementById("adminBox").style.display = "none";
  }

  // If token already exists, show admin UI
  if (getToken()) showAdminUI();

  document.getElementById("loginBtn").addEventListener("click", async () => {
    const id = document.getElementById("loginId").value.trim();
    const password = document.getElementById("loginPass").value;

    const loginStatus = document.getElementById("loginStatus");
    loginStatus.textContent = "Logging in...";

    try {
      const res = await fetch(`${API_BASE}/admin/login`, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ id, password })
      });

      const data = await res.json();

      if (!res.ok) {
        loginStatus.textContent = `❌ ${data.error || "Login failed"}`;
        return;
      }

      setToken(data.token);
      loginStatus.textContent = "✅ Login successful";
      showAdminUI();
    } catch (e) {
      loginStatus.textContent = "❌ Network error";
    }
  });

  document.getElementById("logoutBtn").addEventListener("click", () => {
    clearToken();
    showLoginUI();
  });

  document.getElementById("submitBtn").addEventListener("click", async () => {
    const token = getToken();
    const payload = {
      exam: document.getElementById("exam").value,
      year: document.getElementById("year").value.trim(),
      subject: document.getElementById("subject").value,
      question: document.getElementById("question").value.trim(),
      solution: document.getElementById("solution").value.trim()
    };

    const status = document.getElementById("status");
    status.textContent = "Submitting...";

    try {
      const res = await fetch(`${API_BASE}/add_pyq`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${token}`
        },
        body: JSON.stringify(payload)
      });

      const data = await res.json();

      if (!res.ok) {
        status.textContent = `❌ ${data.error || "Failed"}`;
        return;
      }

      status.textContent = `✅ Added! Total PYQs: ${data.count}`;
      document.getElementById("question").value = "";
      document.getElementById("solution").value = "";
    } catch (e) {
      status.textContent = "❌ Network error";
    }
  });
</script>

</body>
</html>
