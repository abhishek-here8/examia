<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <title>EXAMIA – Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<h1>EXAMIA – Admin</h1>

<section class="topnav">
  <a href="index.html"><i class="fa-solid fa-house"></i> Home</a>
  <a href="pyqs.html"><i class="fa-solid fa-book"></i> PYQs</a>
  <a href="admin.html"><i class="fa-solid fa-user-shield"></i> Admin</a>
  <a href="#" onclick="logout()"><i class="fa-solid fa-right-from-bracket"></i> Logout</a>
</section>

<section id="loginBox">
  <h2>Admin Login</h2>

  <label><b>Admin ID</b></label><br/>
  <input id="loginId" type="text" placeholder="Enter Admin ID" />
  <br/><br/>

  <label><b>Password</b></label><br/>
  <input id="loginPass" type="password" placeholder="Enter Password" />
  <br/><br/>

  <button id="loginBtn">Login</button>
  <p id="loginStatus"></p>
</section>

<section   <div class="sectionTitle">
    <h2><i class="fa-solid fa-user-shield"></i> Admin Dashboard</h2>
    <div class="line"></div>
    <span class="chip"><i class="fa-solid fa-lock"></i> Protected</span>
  </div>

  <div style="display:flex; justify-content: space-between; align-items:center; gap:12px; flex-wrap:wrap;">
    <p class="muted" style="margin:0;">Add new PYQs securely (Admin only).</p>
    <button class="btn danger" id="logoutBtn">
      <i class="fa-solid fa-right-from-bracket"></i> Logout
    </button>
  </div>

  <div class="glass" style="margin-top:14px; padding:16px;">
    <div class="formGrid">
      <div>
        <label><b>Exam</b></label>
        <select id="exam">
          <option value="JEE Main">JEE Main</option>
          <option value="JEE Advanced">JEE Advanced</option>
        </select>
      </div>

      <div>
        <label><b>Year</b></label>
        <input id="year" type="text" value="2023" />
      </div>

      <div>
        <label><b>Subject</b></label>
        <select id="subject">
          <option value="Physics">Physics</option>
          <option value="Chemistry">Chemistry</option>
          <option value="Maths">Maths</option>
        </select>
      </div>

      <div>
        <label><b>Quick Tip</b></label>
        <input type="text" value="Keep solutions short & clear." disabled />
      </div>
    </div>

    <div style="margin-top:12px;">
      <label><b>Question</b></label>
      <textarea id="question" rows="4"></textarea>
    </div>

    <div style="margin-top:12px;">
      <label><b>Solution</b></label>
      <textarea id="solution" rows="4"></textarea>
    </div>

    <div style="margin-top:14px; display:flex; gap:10px; flex-wrap:wrap;">
      <button class="btn primary" id="submitBtn">
        <i class="fa-solid fa-plus"></i> Add PYQ
      </button>
      <span class="chip"><i class="fa-solid fa-database"></i> Saved to server</span>
    </div>

    <p id="status" class="toast info" style="display:none;"></p>
  </div>
  </select>
  <br /><br />

  <label><b>Year</b></label><br />
  <input id="year" type="text" value="2023" />
  <br /><br />

  <label><b>Subject</b></label><br />
  <select id="subject">
    <option value="Physics">Physics</option>
    <option value="Chemistry">Chemistry</option>
    <option value="Maths">Maths</option>
  </select>
  <br /><br />

  <label><b>Question</b></label><br />
  <textarea id="question" rows="4" style="width: 100%;"></textarea>
  <br /><br />

  <label><b>Solution</b></label><br />
  <textarea id="solution" rows="4" style="width: 100%;"></textarea>
  <br /><br />

  <button id="submitBtn">
  <i class="fa-solid fa-plus"></i> Add PYQ
</button>
  <p id="status" style="margin-top: 10px;"></p>
</section>

<script>
  const API_BASE = "https://examia-tkwz.onrender.com";

  function getToken() {
    return sessionStorage.getItem("admin_token");
  }

  function setToken(t) {
    sessionStorage.setItem("admin_token", t);
  }

  function clearToken() {
    sessionStorage.removeItem("admin_token");
  }

  function showAdminUI() {
    document.getElementById("loginBox").style.display = "none";
    document.getElementById("adminBox").style.display = "block";
  }

  function showLoginUI() {
    document.getElementById("loginBox").style.display = "block";
    document.getElementById("adminBox").style.display = "none";
  }

  // If token already exists, show admin UI
  if (getToken()) showAdminUI();

  document.getElementById("loginBtn").addEventListener("click", async () => {
    const id = document.getElementById("loginId").value.trim();
    const password = document.getElementById("loginPass").value;

    const loginStatus = document.getElementById("loginStatus");
    loginStatus.textContent = "Logging in...";

    try {
      const res = await fetch(`${API_BASE}/admin/login`, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ id, password })
      });

      const data = await res.json();

      if (!res.ok) {
        loginStatus.textContent = `❌ ${data.error || "Login failed"}`;
        return;
      }

      setToken(data.token);
      loginStatus.textContent = "✅ Login successful";
      showAdminUI();
    } catch (e) {
      loginStatus.textContent = "❌ Network error";
    }
  });

  document.getElementById("logoutBtn").addEventListener("click", () => {
    clearToken();
    showLoginUI();
  });

  document.getElementById("submitBtn").addEventListener("click", async () => {
    const token = getToken();
    const payload = {
      exam: document.getElementById("exam").value,
      year: document.getElementById("year").value.trim(),
      subject: document.getElementById("subject").value,
      question: document.getElementById("question").value.trim(),
      solution: document.getElementById("solution").value.trim()
    };

    const status = document.getElementById("status");
    status.style.display = "block";
    status.className = "toast info";
    status.textContent = "Submitting...";

    try {
      const res = await fetch(`${API_BASE}/add_pyq`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${token}`
        },
        body: JSON.stringify(payload)
      });

      const data = await res.json();

      if (!res.ok) {
        status.className = "toast err";
        status.textContent = `❌ ${data.error || "Failed"}`;
        return;
      }

      status.className = "toast ok";
      status.textContent = `✅ Added! Total PYQs: ${data.count}`;
      document.getElementById("question").value = "";
      document.getElementById("solution").value = "";
    } catch (e) {
      status.textContent = "❌ Network error";
    }
  });
</script>

</body>
</html>
