<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <div class="exmia-logo" id="exmiaLogo" title="EXAMIA">
  <span class="exmia-sub">Free JEE Preparation</span>
</div>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="admin.css" />
</head>
<body>

<div class="header">EXAMIA – Admin</div>

<div class="nav">
  <a href="index.html">Home</a> |
  <a href="pyqs.html">PYQs</a> |
  <a href="admin.html">Admin</a>
</div>

<div class="container">

  <!-- LOGIN -->
  <div id="loginBox" class="card">
    <h2>Admin Login</h2>

    <div class="row">
      <div>
        <label>Admin ID</label>
        <input id="loginId" type="text" placeholder="Enter Admin ID" />
      </div>

      <div>
        <label>Password</label>
        <input id="loginPass" type="password" placeholder="Enter Password" />
      </div>
    </div>

    <button class="btn" id="loginBtn">Login</button>
    <div id="loginStatus" class="small"></div>
  </div>

  <!-- DASHBOARD -->
  <div id="adminBox" class="card" style="display:none; margin-top:16px;">
    <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;">
      <div>
        <h2 style="margin:0;">Add a New PYQ</h2>
        <div class="small">Protected (Admin only)</div>
      </div>
      <button class="btn2" id="logoutBtn">Logout</button>
    </div>

    <div class="row" style="margin-top:10px;">
      <div>
        <label>Exam</label>
        <select id="exam">
          <option value="JEE Main">JEE Main</option>
          <option value="JEE Advanced">JEE Advanced</option>
        </select>
      </div>

      <div>
        <label>Year</label>
        <input id="year" type="text" value="2023" />
      </div>

      <div>
        <label>Subject</label>
        <select id="subject">
          <option value="Physics">Physics</option>
          <option value="Chemistry">Chemistry</option>
          <option value="Maths">Maths</option>
        </select>
      </div>

      <div></div>
    </div>

    <label>Question</label>
    <textarea id="question" placeholder="Type the question..."></textarea>

    <label>Solution</label>
    <textarea id="solution" placeholder="Type the solution..."></textarea>

    <button class="btn" id="submitBtn">Add PYQ</button>
    <div id="status" class="small"></div>
  </div>

</div>

<script>
  const API_BASE = "https://examia-tkwz.onrender.com";

  function showLoginUI(){
    document.getElementById("loginBox").style.display = "block";
    document.getElementById("adminBox").style.display = "none";
  }
  function showAdminUI(){
    document.getElementById("loginBox").style.display = "none";
    document.getElementById("adminBox").style.display = "block";
  }

  // ✅ Always require login every time
  showLoginUI();

  let token = "";

  document.getElementById("loginBtn").addEventListener("click", async () => {
    const id = document.getElementById("loginId").value.trim();
    const password = document.getElementById("loginPass").value;

    const loginStatus = document.getElementById("loginStatus");
    loginStatus.textContent = "Logging in...";

    try {
      const res = await fetch(`${API_BASE}/admin/login`, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ id, password })
      });

      const data = await res.json();

      if (!res.ok) {
        loginStatus.textContent = "❌ " + (data.error || "Login failed");
        return;
      }

      token = data.token;
      loginStatus.textContent = "✅ Login successful";
      showAdminUI();
    } catch (e) {
      loginStatus.textContent = "❌ Network error";
    }
  });

  document.getElementById("logoutBtn").addEventListener("click", () => {
    token = "";
    showLoginUI();
  });

  document.getElementById("submitBtn").addEventListener("click", async () => {
    const payload = {
      exam: document.getElementById("exam").value,
      year: document.getElementById("year").value.trim(),
      subject: document.getElementById("subject").value,
      question: document.getElementById("question").value.trim(),
      solution: document.getElementById("solution").value.trim()
    };

    const status = document.getElementById("status");
    status.textContent = "Submitting...";

    try {
      const res = await fetch(`${API_BASE}/add_pyq`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${token}`
        },
        body: JSON.stringify(payload)
      });

      const data = await res.json();

      if (!res.ok) {
        status.textContent = "❌ " + (data.error || "Failed");
        return;
      }

      status.textContent = `✅ Added! Total PYQs: ${data.count}`;
      document.getElementById("question").value = "";
      document.getElementById("solution").value = "";
    } catch (e) {
      status.textContent = "❌ Network error";
    }
  });
</script>
<script>
  const logo = document.getElementById("exmiaLogo");
  if (logo) {
    logo.classList.add("idle-float");

    let running = false;
    logo.addEventListener("mouseenter", () => {
      if (running) return;
      running = true;

      logo.classList.remove("flow-once");
      void logo.offsetWidth;     // reset animation
      logo.classList.add("flow-once");

      logo.addEventListener("animationend", () => {
        logo.classList.remove("flow-once");
        running = false;
      }, { once: true });
    });
  }
</script>
</body>
</html>
